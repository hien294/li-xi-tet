<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Xóc Lì Xì Tết - Tâm Thư & 24 Phong Bao</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;800&family=Dancing+Script:wght@600;700&family=Montserrat:wght@400;600;700&family=Noto+Serif:wght@400;700&family=Sacramento&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;800&family=Dancing+Script:wght@600;700&family=Montserrat:wght@400;600;700&family=Noto+Serif:wght@400;700&family=Sacramento&display=swap");

      * {
        font-family: "Montserrat", sans-serif;
      }

      .font-playfair {
        font-family: "Playfair Display", serif;
      }

      .font-dancing {
        font-family: "Dancing Script", cursive;
      }

      .font-noto {
        font-family: "Noto Serif", serif;
      }

      .font-signature {
        font-family: "Sacramento", cursive;
      }

      body {
        background:
          linear-gradient(rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.8)),
          url("https://images.unsplash.com/photo-1518709268805-4e9042af2176?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1920&q=80");
        background-size: cover;
        background-attachment: fixed;
        background-position: center;
        min-height: 100vh;
        scroll-behavior: smooth;
      }

      /* Hongbao Styles */
      .hongbao-card {
        background: linear-gradient(135deg, #b22222 0%, #8b0000 100%);
        border: 2px solid #d4af37;
        box-shadow: 0 8px 20px rgba(212, 175, 55, 0.3);
        transition: all 0.3s ease;
      }

      @media (max-width: 640px) {
        .hongbao-card {
          height: 160px;
        }
      }

      .hongbao-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 25px rgba(212, 175, 55, 0.5);
      }

      .hongbao-card.selected {
        transform: scale(1.03);
        border-color: #ffd700;
        box-shadow: 0 0 25px rgba(255, 215, 0, 0.6);
      }

      .hongbao-top {
        background: linear-gradient(to right, #d4af37, #ffd700, #d4af37);
      }

      .hongbao-number {
        background: linear-gradient(135deg, #d4af37, #ffd700);
        color: #b22222;
        border: 2px solid white;
        font-weight: bold;
      }

      /* Dice Styles - IMPROVED with better connection */
      .dice-container {
        perspective: 1000px;
      }

      .dice {
        width: 55px;
        height: 55px;
        position: relative;
        transform-style: preserve-3d;
        transition: transform 1s;
        border-radius: 10px;
        /* Add glow to connect dice */
        box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
      }

      .dice.rolling {
        animation: rollDice 1s infinite linear;
      }

      @keyframes rollDice {
        0% {
          transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg);
        }
        100% {
          transform: rotateX(360deg) rotateY(360deg) rotateZ(360deg);
        }
      }

      .dice-face {
        position: absolute;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          145deg,
          #8b0000,
          #b22222
        ); /* Gradient for depth */
        border: 2px solid #ffd700;
        display: flex;
        justify-content: center;
        align-items: center;
        font-weight: bold;
        font-size: 1.2rem;
        color: white;
        overflow: hidden;
        border-radius: 10px;
        box-shadow:
          inset 0 0 10px rgba(0, 0, 0, 0.3),
          0 2px 5px rgba(0, 0, 0, 0.2); /* Outer shadow for connection */
      }

      /* Dice face positions */
      .dice-face:nth-child(1) {
        transform: translateZ(27.5px);
      }
      .dice-face:nth-child(2) {
        transform: rotateY(90deg) translateZ(27.5px);
      }
      .dice-face:nth-child(3) {
        transform: rotateY(180deg) translateZ(27.5px);
      }
      .dice-face:nth-child(4) {
        transform: rotateY(-90deg) translateZ(27.5px);
      }
      .dice-face:nth-child(5) {
        transform: rotateX(90deg) translateZ(27.5px);
      }
      .dice-face:nth-child(6) {
        transform: rotateX(-90deg) translateZ(27.5px);
      }

      /* Dice dots patterns */
      .dice-dots {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        grid-template-rows: repeat(3, 1fr);
        width: 100%;
        height: 100%;
        padding: 8px;
      }

      .dot {
        width: 9px;
        height: 9px;
        background-color: white;
        border-radius: 50%;
        justify-self: center;
        align-self: center;
        box-shadow:
          0 1px 3px rgba(0, 0, 0, 0.3),
          0 0 5px rgba(255, 255, 255, 0.5); /* Glow effect for dots */
      }

      /* Patterns for each face */
      .face-1 .dot:nth-child(5) {
        display: block;
      }
      .face-1 .dot:not(:nth-child(5)) {
        display: none;
      }

      .face-2 .dot:nth-child(1),
      .face-2 .dot:nth-child(9) {
        display: block;
      }
      .face-2 .dot:not(:nth-child(1)):not(:nth-child(9)) {
        display: none;
      }

      .face-3 .dot:nth-child(1),
      .face-3 .dot:nth-child(5),
      .face-3 .dot:nth-child(9) {
        display: block;
      }
      .face-3 .dot:not(:nth-child(1)):not(:nth-child(5)):not(:nth-child(9)) {
        display: none;
      }

      .face-4 .dot:nth-child(1),
      .face-4 .dot:nth-child(3),
      .face-4 .dot:nth-child(7),
      .face-4 .dot:nth-child(9) {
        display: block;
      }
      .face-4
        .dot:not(:nth-child(1)):not(:nth-child(3)):not(:nth-child(7)):not(
          :nth-child(9)
        ) {
        display: none;
      }

      .face-5 .dot:nth-child(1),
      .face-5 .dot:nth-child(3),
      .face-5 .dot:nth-child(5),
      .face-5 .dot:nth-child(7),
      .face-5 .dot:nth-child(9) {
        display: block;
      }
      .face-5
        .dot:not(:nth-child(1)):not(:nth-child(3)):not(:nth-child(5)):not(
          :nth-child(7)
        ):not(:nth-child(9)) {
        display: none;
      }

      .face-6 .dot:nth-child(1),
      .face-6 .dot:nth-child(3),
      .face-6 .dot:nth-child(4),
      .face-6 .dot:nth-child(6),
      .face-6 .dot:nth-child(7),
      .face-6 .dot:nth-child(9) {
        display: block;
      }
      .face-6
        .dot:not(:nth-child(1)):not(:nth-child(3)):not(:nth-child(4)):not(
          :nth-child(6)
        ):not(:nth-child(7)):not(:nth-child(9)) {
        display: none;
      }

      /* Scratch Card */
      .scratch-card-container {
        position: relative;
        overflow: hidden;
        cursor:
          url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40"><circle cx="20" cy="20" r="18" fill="none" stroke="%23D4AF37" stroke-width="3"/></svg>')
            20 20,
          auto;
        border-radius: 12px;
        background: linear-gradient(135deg, #ffd700 0%, #d4af37 100%);
      }

      .scratch-canvas {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 20;
        touch-action: none;
      }

      .scratch-content {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 10;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 1.5rem;
      }

      .scratch-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background:
          repeating-linear-gradient(
            45deg,
            #c0c0c0,
            #c0c0c0 10px,
            #d3d3d3 10px,
            #d3d3d3 20px
          ),
          linear-gradient(
            to bottom,
            rgba(255, 255, 255, 0.1) 0%,
            rgba(255, 255, 255, 0.3) 50%,
            rgba(255, 255, 255, 0.1) 100%
          );
        z-index: 15;
        border-radius: 12px;
        box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.2);
      }

      /* Modal Positioning */
      .modal-center {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 100;
        width: 90%;
        max-width: 900px;
      }

      @media (max-width: 768px) {
        .modal-center {
          width: 95%;
          max-height: 90vh;
          overflow-y: auto;
        }
      }

      /* Selection Cards - REMOVED left border */
      .selection-card {
        transition: all 0.3s ease;
        background: linear-gradient(
          135deg,
          rgba(178, 34, 34, 0.7) 0%,
          rgba(139, 0, 0, 0.7) 100%
        );
        border: 2px solid rgba(212, 175, 55, 0.5);
        border-radius: 12px;
      }

      .selection-card:hover {
        transform: scale(1.05);
        border-color: #d4af37;
      }

      .selection-card.selected {
        background: linear-gradient(135deg, #d4af37 0%, #ffd700 100%);
        color: #b22222;
        border-color: #b22222;
        box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
      }

      /* Gold Text Effect */
      .gold-text {
        background: linear-gradient(
          to right,
          #d4af37 0%,
          #ffd700 30%,
          #d4af37 70%,
          #ffd700 100%
        );
        background-size: 200% auto;
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: shine 3s linear infinite;
      }

      @keyframes shine {
        to {
          background-position: 200% center;
        }
      }

      /* Letter Style */
      .letter-paper {
        background: linear-gradient(to bottom, #fff8e1, #ffecb3);
        position: relative;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        border-radius: 12px;
        overflow: hidden;
      }

      .letter-paper::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 30px;
        background: linear-gradient(
          to bottom,
          rgba(139, 0, 0, 0.1),
          transparent
        );
      }

      /* Signature Style - IMPROVED (smaller and normal) */
      .signature-box {
        border-top: 1px solid #b22222;
        padding-top: 15px;
        margin-top: 20px;
        position: relative;
      }

      .signature {
        font-family:
          "Montserrat", sans-serif; /* Changed from cursive to normal font */
        font-size: 1.2rem; /* Smaller size */
        color: #b22222;
        text-align: right;
        font-weight: 600;
        letter-spacing: 1px;
        display: inline-block;
        position: relative;
      }

      .signature::after {
        content: "";
        position: absolute;
        bottom: -3px;
        right: 0;
        width: 60%;
        height: 1px;
        background: linear-gradient(to right, transparent, #b22222);
      }

      /* Active Section Indicator - REMOVED left border */
      .active-section {
        /* Removed border-left property */
        padding-left: 0; /* Reset padding */
      }

      /* Blinking Animation */
      @keyframes blink {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      .blinking {
        animation: blink 1.5s infinite;
      }

      /* Fade In Animation */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .fade-in {
        animation: fadeIn 0.5s ease-out forwards;
      }

      /* Dice glow animation for better connection */
      @keyframes diceGlow {
        0%,
        100% {
          box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
        }
        50% {
          box-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
        }
      }

      .dice.rolling {
        animation:
          rollDice 1s infinite linear,
          diceGlow 2s infinite alternate;
      }

      /* Scroll down indicator */
      .scroll-indicator {
        position: absolute;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        color: #d4af37;
        animation: bounce 2s infinite;
      }

      @keyframes bounce {
        0%,
        20%,
        50%,
        80%,
        100% {
          transform: translateY(0);
        }
        40% {
          transform: translateY(-10px);
        }
        60% {
          transform: translateY(-5px);
        }
      }

      /* Step Indicator */
      .step-indicator {
        display: flex;
        justify-content: center;
        margin-bottom: 30px;
        gap: 10px;
      }

      .step-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: rgba(212, 175, 55, 0.3);
        transition: all 0.3s ease;
      }

      .step-dot.active {
        background: #d4af37;
        transform: scale(1.3);
      }

      .step-dot.completed {
        background: #b22222;
      }
    </style>
  </head>
  <body class="text-white">
    <!-- Main Container -->
    <div class="container mx-auto px-4 py-6">
      <!-- Header -->
      <header class="text-center mb-10">
        <div class="flex flex-col items-center mb-6">
          <div
            class="w-20 h-20 bg-gradient-to-br from-red-600 to-amber-500 rounded-full flex items-center justify-center mb-4 shadow-2xl"
          >
            <i class="fas fa-envelope-open-text text-3xl text-white"></i>
          </div>
          <h1
            class="text-4xl md:text-5xl font-playfair font-bold gold-text mb-3"
          >
            TÂM THƯ LÌ XÌ TẾT
          </h1>
          <div class="text-xl md:text-2xl font-dancing text-amber-300 mb-4">
            Gửi trao yêu thương - Nhận lộc an khang
          </div>
          <div
            class="text-base md:text-lg text-amber-200 max-w-2xl mx-auto bg-black/30 backdrop-blur-sm rounded-xl p-3"
          >
            Chọn mối quan hệ, chọn độ tuổi, chọn phong bao và nhận tâm thư cùng
            lộc xuân
          </div>
        </div>

        <!-- Step Indicator -->
        <div class="step-indicator">
          <div class="step-dot active" id="step1-dot"></div>
          <div class="step-dot" id="step2-dot"></div>
          <div class="step-dot" id="step3-dot"></div>
        </div>
      </header>

      <!-- Relationship Selection (Step 1) -->
      <div
        id="relationship-selection"
        class="max-w-6xl mx-auto mb-12 section-transition"
      >
        <h2
          class="text-2xl md:text-3xl font-playfair font-bold text-center text-amber-300 mb-6"
        >
          <i class="fas fa-heart mr-3"></i> BẠN ĐANG LÌ XÌ CHO AI?
        </h2>
        <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 md:gap-6 mb-8">
          <!-- Relationship options will be generated by JavaScript -->
        </div>

        <div class="scroll-indicator hidden" id="scroll-to-age">
          <i class="fas fa-chevron-down text-2xl"></i>
        </div>
      </div>

      <!-- Age Selection (Step 2) -->
      <div
        id="age-selection"
        class="max-w-6xl mx-auto mb-12 section-transition hidden"
      >
        <h2
          class="text-2xl md:text-3xl font-playfair font-bold text-center text-amber-300 mb-6"
        >
          <i class="fas fa-user-clock mr-3"></i> ĐỘ TUỔI CỦA NGƯỜI NHẬN
        </h2>
        <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 md:gap-6 mb-8">
          <!-- Age options will be generated by JavaScript -->
        </div>

        <div class="scroll-indicator hidden" id="scroll-to-hongbao">
          <i class="fas fa-chevron-down text-2xl"></i>
        </div>
      </div>

      <!-- Hongbao Selection (Step 3) -->
      <div
        id="hongbao-selection"
        class="max-w-6xl mx-auto mb-12 section-transition hidden"
      >
        <h2
          class="text-2xl md:text-3xl font-playfair font-bold text-center text-amber-300 mb-6"
        >
          <i class="fas fa-gift mr-3"></i> CHỌN PHONG BAO MAY MẮN
        </h2>
        <div
          class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-3 md:gap-4"
          id="hongbao-grid"
        >
          <!-- 24 Hongbao items will be generated by JavaScript -->
        </div>
      </div>

      <!-- Footer -->
      <footer
        class="text-center text-amber-200/70 mt-12 border-t border-amber-900/30 pt-4"
      >
        <p class="mb-1 text-sm">
          Tâm Thư Lì Xì Tết © 2024 - Gửi gắm yêu thương, trao nhận phúc lộc
        </p>
        <p class="text-xs opacity-70">
          24 phong bao - 8 mối quan hệ - Vô vàn lời chúc ý nghĩa
        </p>
      </footer>
    </div>

    <!-- Result Modal -->
    <div id="result-modal" class="modal-center hidden">
      <div
        class="bg-gradient-to-br from-gray-900 to-black rounded-xl md:rounded-2xl overflow-hidden shadow-2xl border-2 md:border-4 border-amber-500"
      >
        <!-- Modal Header -->
        <div
          class="bg-gradient-to-r from-red-800 to-amber-700 p-4 md:p-6 text-center relative"
        >
          <div
            class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-amber-300 to-transparent"
          ></div>
          <h2 class="text-xl md:text-2xl font-playfair font-bold text-white">
            TÂM THƯ & LỘC XUÂN
          </h2>
          <button
            id="close-modal"
            class="absolute top-3 right-3 md:top-4 md:right-4 text-white hover:text-amber-300 text-lg md:text-xl"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>

        <!-- Modal Body -->
        <div class="p-4 md:p-6">
          <!-- Dice Rolling Section -->
          <div id="dice-section" class="text-center mb-6">
            <div
              class="dice-container flex justify-center space-x-4 md:space-x-8 mb-4"
            >
              <!-- Dice 1 -->
              <div class="dice rolling" id="dice1">
                <div class="dice-face face-1">
                  <div class="dice-dots">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                  </div>
                </div>
                <div class="dice-face face-2">
                  <div class="dice-dots">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                  </div>
                </div>
                <div class="dice-face face-3">
                  <div class="dice-dots">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                  </div>
                </div>
                <div class="dice-face face-4">
                  <div class="dice-dots">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                  </div>
                </div>
                <div class="dice-face face-5">
                  <div class="dice-dots">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                  </div>
                </div>
                <div class="dice-face face-6">
                  <div class="dice-dots">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                  </div>
                </div>
              </div>
              <!-- Dice 2 -->
              <div class="dice rolling" id="dice2">
                <div class="dice-face face-1">
                  <div class="dice-dots">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                  </div>
                </div>
                <div class="dice-face face-2">
                  <div class="dice-dots">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                  </div>
                </div>
                <div class="dice-face face-3">
                  <div class="dice-dots">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                  </div>
                </div>
                <div class="dice-face face-4">
                  <div class="dice-dots">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                  </div>
                </div>
                <div class="dice-face face-5">
                  <div class="dice-dots">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                  </div>
                </div>
                <div class="dice-face face-6">
                  <div class="dice-dots">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                  </div>
                </div>
              </div>
              <!-- Dice 3 -->
              <div class="dice rolling" id="dice3">
                <div class="dice-face face-1">
                  <div class="dice-dots">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                  </div>
                </div>
                <div class="dice-face face-2">
                  <div class="dice-dots">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                  </div>
                </div>
                <div class="dice-face face-3">
                  <div class="dice-dots">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                  </div>
                </div>
                <div class="dice-face face-4">
                  <div class="dice-dots">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                  </div>
                </div>
                <div class="dice-face face-5">
                  <div class="dice-dots">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                  </div>
                </div>
                <div class="dice-face face-6">
                  <div class="dice-dots">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="text-lg md:text-xl font-bold text-amber-400 blinking">
              <i class="fas fa-spinner animate-spin mr-2"></i> ĐANG TẠO TÂM
              THƯ...
            </div>
          </div>

          <!-- Letter & Scratch Section -->
          <div id="letter-scratch-section" class="hidden">
            <div class="flex flex-col lg:flex-row gap-6">
              <!-- Left: Letter Section -->
              <div class="lg:w-1/2">
                <div class="letter-paper rounded-lg p-4 md:p-6 h-full">
                  <div class="text-center mb-4">
                    <div
                      class="text-red-700 font-dancing text-2xl md:text-3xl mb-2"
                    >
                      TÂM THƯ XUÂN
                    </div>
                    <div class="text-amber-700 text-sm mb-4">
                      Gửi đến người thân yêu
                    </div>
                  </div>

                  <div class="space-y-4 font-noto text-gray-800">
                    <div
                      id="letter-date"
                      class="text-right text-sm italic text-gray-600 mb-2"
                    ></div>

                    <div
                      id="letter-greeting"
                      class="text-lg font-bold text-red-700 mb-3"
                    ></div>

                    <div
                      id="letter-content"
                      class="text-base md:text-lg leading-relaxed"
                    >
                      <!-- Letter content will be inserted here -->
                    </div>

                    <div class="signature-box">
                      <div
                        id="letter-closing"
                        class="text-right mb-4 font-dancing text-red-700 text-xl"
                      ></div>
                      <div class="text-right">
                        <div class="signature">Nguyễn Ngọc Hiển</div>
                        <div class="text-gray-600 text-sm mt-1">Người gửi</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Right: Scratch Card Section -->
              <div class="lg:w-1/2">
                <div class="h-full flex flex-col">
                  <div class="mb-4 text-center">
                    <div
                      class="text-lg md:text-xl font-bold text-amber-300 blinking"
                    >
                      <i class="fas fa-hand-point-down mr-2"></i> CÀO NHẬN LỘC
                      XUÂN
                    </div>
                    <div class="text-amber-200/80 text-sm mt-1">
                      Cào nhẹ lớp bạc để khám phá may mắn
                    </div>
                  </div>

                  <div class="flex-grow">
                    <div
                      class="scratch-card-container rounded-lg h-48 md:h-64 relative"
                    >
                      <!-- Scratch Overlay -->
                      <div class="scratch-overlay rounded-lg"></div>

                      <!-- Scratch Canvas -->
                      <canvas
                        id="scratch-canvas"
                        class="scratch-canvas rounded-lg"
                      ></canvas>

                      <!-- Scratch Content -->
                      <div class="scratch-content rounded-lg">
                        <div class="text-center">
                          <div class="text-amber-900 font-bold text-sm mb-2">
                            LỘC XUÂN MAY MẮN
                          </div>
                          <div
                            class="money-amount text-3xl md:text-4xl font-bold text-red-700 mb-2"
                            id="money-amount"
                          >
                            0 ₫
                          </div>
                          <div
                            id="money-message"
                            class="text-red-800 text-base md:text-lg font-medium"
                          >
                            <!-- Money message will be inserted here -->
                          </div>
                          <div class="mt-3 text-amber-900/70 text-xs">
                            465XWPCEW - Phúc Lộc Tràn Đầy
                          </div>
                        </div>
                      </div>
                    </div>

                    <div
                      class="text-center text-amber-300 text-xs md:text-sm italic mt-3"
                    >
                      <i class="fas fa-info-circle mr-1"></i> Dùng chuột hoặc
                      ngón tay cào nhẹ lên thẻ
                    </div>
                  </div>

                  <!-- Action Button -->
                  <div class="flex justify-center mt-6">
                    <button
                      id="play-again-btn"
                      class="px-6 md:px-8 py-2 md:py-3 bg-gradient-to-r from-red-700 to-amber-600 text-white font-bold rounded-lg hover:shadow-lg transition-all hidden fade-in"
                    >
                      <i class="fas fa-redo mr-2"></i> Viết Tâm Thư Mới
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Overlay for Modal -->
    <div id="modal-overlay" class="fixed inset-0 bg-black/80 z-40 hidden"></div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Elements
        const relationshipSelection = document.getElementById(
          "relationship-selection",
        );
        const relationshipGrid = relationshipSelection.querySelector(".grid");
        const ageSelection = document.getElementById("age-selection");
        const ageGrid = ageSelection.querySelector(".grid");
        const hongbaoSelection = document.getElementById("hongbao-selection");
        const hongbaoGrid = document.getElementById("hongbao-grid");
        const resultModal = document.getElementById("result-modal");
        const modalOverlay = document.getElementById("modal-overlay");
        const diceSection = document.getElementById("dice-section");
        const letterScratchSection = document.getElementById(
          "letter-scratch-section",
        );
        const dice1 = document.getElementById("dice1");
        const dice2 = document.getElementById("dice2");
        const dice3 = document.getElementById("dice3");
        const letterDate = document.getElementById("letter-date");
        const letterGreeting = document.getElementById("letter-greeting");
        const letterContent = document.getElementById("letter-content");
        const letterClosing = document.getElementById("letter-closing");
        const scratchCanvas = document.getElementById("scratch-canvas");
        const moneyAmount = document.getElementById("money-amount");
        const moneyMessage = document.getElementById("money-message");
        const closeModalBtn = document.getElementById("close-modal");
        const playAgainBtn = document.getElementById("play-again-btn");
        const step1Dot = document.getElementById("step1-dot");
        const step2Dot = document.getElementById("step2-dot");
        const step3Dot = document.getElementById("step3-dot");
        const scrollToAge = document.getElementById("scroll-to-age");
        const scrollToHongbao = document.getElementById("scroll-to-hongbao");

        // Variables
        let selectedRelationship = null;
        let selectedAge = null;
        let selectedHongbao = null;
        let isRolling = false;
        let isScratching = false;
        let ctx = null;
        let currentAmount = 0;
        let selectedRelationshipId = "";
        let selectedAgeId = "";

        // Relationships (8 options)
        const relationships = [
          {
            id: "grandparents",
            name: "Ông Bà",
            icon: "fas fa-users",
            formal: "Kính gửi Ông Bà",
          },
          {
            id: "parents",
            name: "Bố Mẹ",
            icon: "fas fa-home",
            formal: "Kính gửi Bố Mẹ",
          },
          {
            id: "children",
            name: "Con Cái",
            icon: "fas fa-child",
            formal: "Gửi các con yêu",
          },
          {
            id: "siblings",
            name: "Anh Chị Em",
            icon: "fas fa-user-friends",
            formal: "Gửi anh/chị/em",
          },
          {
            id: "aunt_uncle",
            name: "Cô Dì Chú Bác",
            icon: "fas fa-hands-helping",
            formal: "Kính gửi Cô/Dì/Chú/Bác",
          },
          {
            id: "friends",
            name: "Bạn Bè",
            icon: "fas fa-user-friends",
            formal: "Gửi bạn thân",
          },
          {
            id: "colleagues",
            name: "Đồng Nghiệp",
            icon: "fas fa-briefcase",
            formal: "Gửi đồng nghiệp",
          },
          {
            id: "lovers",
            name: "Người Yêu",
            icon: "fas fa-heart",
            formal: "Gửi người yêu dấu",
          },
        ];

        // Age groups (8 options)
        const ageGroups = [
          {
            id: "child",
            name: "Trẻ Em",
            range: "1-12 tuổi",
            icon: "fas fa-baby",
          },
          {
            id: "teen",
            name: "Thiếu Niên",
            range: "13-17 tuổi",
            icon: "fas fa-user-graduate",
          },
          {
            id: "young_adult",
            name: "Thanh Niên",
            range: "18-25 tuổi",
            icon: "fas fa-user-graduate",
          },
          {
            id: "adult",
            name: "Trưởng Thành",
            range: "26-40 tuổi",
            icon: "fas fa-user-tie",
          },
          {
            id: "middle_age",
            name: "Trung Niên",
            range: "41-55 tuổi",
            icon: "fas fa-user",
          },
          {
            id: "senior",
            name: "Trung Lão",
            range: "56-70 tuổi",
            icon: "fas fa-user-friends",
          },
          {
            id: "elder",
            name: "Cao Tuổi",
            range: "71-85 tuổi",
            icon: "fas fa-user-clock",
          },
          {
            id: "venerable",
            name: "Thượng Thọ",
            range: "86+ tuổi",
            icon: "fas fa-user-ninja",
          },
        ];

        // Money Messages
        const moneyMessages = [
          "Chúc bạn một năm thịnh vượng!",
          "Tài lộc dồi dào quanh năm!",
          "Phúc khí tràn đầy, may mắn không ngừng!",
          "Lộc xuân về nhà, phúc đến cửa!",
          "Một năm mới an khang và thành công!",
          "Vạn sự như Ý, trăm sự cát tường!",
          "Xuân an vui, Tết hạnh phúc!",
          "Cung chúc tân xuân phước vĩnh cửu!",
        ];

        // Letter closings
        const letterClosings = {
          grandparents: "Kính chúc Ông Bà",
          parents: "Kính chúc Bố Mẹ",
          children: "Thương yêu",
          siblings: "Thân ái",
          aunt_uncle: "Kính chúc",
          friends: "Thân mến",
          colleagues: "Trân trọng",
          lovers: "Yêu thương",
        };

        // Update Step Indicator
        function updateStepIndicator(currentStep) {
          step1Dot.classList.remove("completed", "active");
          step2Dot.classList.remove("completed", "active");
          step3Dot.classList.remove("completed", "active");

          if (currentStep === 1) {
            step1Dot.classList.add("active");
          } else if (currentStep === 2) {
            step1Dot.classList.add("completed");
            step2Dot.classList.add("active");
          } else if (currentStep === 3) {
            step1Dot.classList.add("completed");
            step2Dot.classList.add("completed");
            step3Dot.classList.add("active");
          }
        }

        // Initialize Relationship Selection
        function initRelationshipSelection() {
          relationshipGrid.innerHTML = "";

          relationships.forEach((relationship) => {
            const card = document.createElement("div");
            card.className =
              "selection-card rounded-xl p-4 text-center cursor-pointer h-full";
            card.dataset.relationship = relationship.id;

            card.innerHTML = `
                        <div class="text-3xl text-amber-300 mb-3">
                            <i class="${relationship.icon}"></i>
                        </div>
                        <div class="text-lg font-bold text-white mb-1">${relationship.name}</div>
                        <div class="text-amber-200 text-sm">${relationship.formal}</div>
                    `;

            card.addEventListener("click", function () {
              if (selectedRelationship === this) return;

              document
                .querySelectorAll("#relationship-selection .selection-card")
                .forEach((c) => {
                  c.classList.remove("selected");
                });

              selectedRelationship = this;
              selectedRelationshipId = relationship.id;
              this.classList.add("selected");

              updateStepIndicator(2);
              scrollToAge.classList.remove("hidden");

              setTimeout(() => {
                initAgeSelection();
                ageSelection.classList.remove("hidden");
                ageSelection.scrollIntoView({
                  behavior: "smooth",
                  block: "start",
                });

                setTimeout(() => {
                  scrollToAge.classList.add("hidden");
                }, 1000);
              }, 300);
            });

            relationshipGrid.appendChild(card);
          });

          updateStepIndicator(1);
        }

        // Initialize Age Selection
        function initAgeSelection() {
          ageGrid.innerHTML = "";

          ageGroups.forEach((age) => {
            const card = document.createElement("div");
            card.className =
              "selection-card rounded-xl p-4 text-center cursor-pointer h-full";
            card.dataset.age = age.id;

            card.innerHTML = `
                        <div class="text-3xl text-amber-300 mb-3">
                            <i class="${age.icon}"></i>
                        </div>
                        <div class="text-lg font-bold text-white mb-1">${age.name}</div>
                        <div class="text-amber-200 text-sm">${age.range}</div>
                    `;

            card.addEventListener("click", function () {
              if (selectedAge === this) return;

              document
                .querySelectorAll("#age-selection .selection-card")
                .forEach((c) => {
                  c.classList.remove("selected");
                });

              selectedAge = this;
              selectedAgeId = age.id;
              this.classList.add("selected");

              updateStepIndicator(3);
              scrollToHongbao.classList.remove("hidden");

              setTimeout(() => {
                createHongbaos();
                hongbaoSelection.classList.remove("hidden");
                hongbaoSelection.scrollIntoView({
                  behavior: "smooth",
                  block: "start",
                });

                setTimeout(() => {
                  scrollToHongbao.classList.add("hidden");
                }, 1000);
              }, 300);
            });

            ageGrid.appendChild(card);
          });
        }

        // Create 24 Hongbaos
        function createHongbaos() {
          hongbaoGrid.innerHTML = "";

          const colorVariants = [
            "from-red-600 to-red-800",
            "from-red-700 to-red-900",
            "from-amber-600 to-amber-800",
            "from-red-800 to-red-950",
            "from-amber-700 to-amber-900",
            "from-red-900 to-amber-900",
            "from-amber-800 to-red-900",
            "from-red-700 to-amber-800",
            "from-amber-900 to-red-800",
            "from-red-800 to-amber-700",
            "from-amber-800 to-red-950",
            "from-red-950 to-amber-800",
            "from-amber-900 to-red-700",
            "from-red-900 to-amber-950",
            "from-red-600 to-amber-700",
            "from-amber-700 to-red-800",
            "from-red-800 to-amber-800",
            "from-amber-800 to-red-700",
            "from-red-700 to-amber-900",
            "from-amber-900 to-red-600",
            "from-red-900 to-amber-700",
            "from-amber-700 to-red-900",
            "from-red-600 to-amber-800",
            "from-amber-800 to-red-600",
          ];

          for (let i = 1; i <= 24; i++) {
            const colorClass = colorVariants[i - 1];

            const hongbaoItem = document.createElement("div");
            hongbaoItem.className = `hongbao-card rounded-lg flex flex-col cursor-pointer h-40 md:h-48`;
            hongbaoItem.dataset.id = i;

            hongbaoItem.innerHTML = `
                        <!-- Top Gold Part -->
                        <div class="hongbao-top h-8 md:h-10 rounded-t-lg flex items-center justify-center relative overflow-hidden">
                            <div class="text-red-900 font-bold text-sm md:text-base tracking-wider relative z-10">LỘC</div>
                        </div>
                        
                        <!-- Main Body -->
                        <div class="flex-grow bg-gradient-to-br ${colorClass} rounded-b-lg p-3 flex flex-col items-center justify-center relative">
                            <!-- Number Badge -->
                            <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 hongbao-number w-8 h-8 rounded-full flex items-center justify-center text-sm shadow-lg">
                                ${i}
                            </div>
                            
                            <!-- Content -->
                            <div class="text-amber-200 text-lg font-bold mb-1 font-playfair">BAO</div>
                            <div class="text-amber-300 text-2xl md:text-3xl font-bold font-dancing">${String(i).padStart(2, "0")}</div>
                            <div class="text-amber-100/80 text-xs mt-1">Nhấn chọn</div>
                            
                            <!-- Decorative Elements -->
                            <div class="absolute bottom-1 left-1 text-amber-300/20">
                                <i class="fas fa-circle text-[6px]"></i>
                                <i class="fas fa-circle text-[6px] ml-[2px]"></i>
                            </div>
                            <div class="absolute bottom-1 right-1 text-amber-300/20">
                                <i class="fas fa-circle text-[6px]"></i>
                                <i class="fas fa-circle text-[6px] ml-[2px]"></i>
                            </div>
                        </div>
                    `;

            hongbaoItem.addEventListener("click", function () {
              if (selectedHongbao === this || isRolling) return;

              document.querySelectorAll(".hongbao-card").forEach((item) => {
                item.classList.remove("selected");
              });

              selectedHongbao = this;
              this.classList.add("selected");

              setTimeout(() => {
                showResultModal(i);
              }, 500);
            });

            hongbaoGrid.appendChild(hongbaoItem);
          }
        }

        // Show Result Modal
        function showResultModal(selectedId) {
          diceSection.classList.remove("hidden");
          letterScratchSection.classList.add("hidden");
          playAgainBtn.classList.add("hidden");

          resultModal.classList.remove("hidden");
          modalOverlay.classList.remove("hidden");
          document.body.style.overflow = "hidden";

          startDiceRolling(selectedId);
        }

        // Start Dice Rolling
        function startDiceRolling(selectedId) {
          isRolling = true;

          dice1.classList.add("rolling");
          dice2.classList.add("rolling");
          dice3.classList.add("rolling");

          currentAmount = getRandomAmount();
          const letter = generateLetter();
          const message =
            moneyMessages[Math.floor(Math.random() * moneyMessages.length)];

          setTimeout(() => {
            stopDiceRolling();
            isRolling = false;

            setTimeout(() => {
              showLetterAndScratch(letter, currentAmount, message);
            }, 1000);
          }, 3000);
        }

        // Generate Letter
        function generateLetter() {
          const today = new Date();
          const dateStr = today.toLocaleDateString("vi-VN", {
            day: "numeric",
            month: "long",
            year: "numeric",
          });

          const relationship = relationships.find(
            (r) => r.id === selectedRelationshipId,
          );

          let content = "";

          switch (selectedRelationshipId) {
            case "grandparents":
              content = `Xuân mới lại về, mang theo bao niềm vui và hy vọng. Nhân dịp năm mới, cháu xin gửi đến Ông Bà lời chúc sức khỏe, an khang và thịnh vượng.<br><br>Chúc Ông Bà luôn dồi dào sức khỏe, tinh thần minh mẫn, và tràn đầy niềm vui trong cuộc sống. Mong rằng năm mới sẽ mang đến nhiều may mắn, thành công và hạnh phúc cho Ông Bà.<br><br>Dù không gian có cách trở nhưng tấm lòng và tình cảm luôn hướng về Ông Bà. Xin gửi qua những dòng chữ này tất cả sự kính trọng và yêu thương chân thành nhất.`;
              break;
            case "parents":
              content = `Gửi Bố Mẹ yêu quý,<br><br>Xuân mới lại về, con xin gửi đến Bố Mẹ những lời chúc tốt đẹp nhất. Chúc Bố Mẹ năm mới thật nhiều sức khỏe, luôn vui vẻ và hạnh phúc.<br><br>Cảm ơn Bố Mẹ đã luôn yêu thương, chăm sóc và dạy dỗ con nên người. Mỗi dịp Tết đến, con lại nhớ về những kỷ niệm đẹp bên gia đình, những bữa cơm sum vầy ấm áp.<br><br>Con hứa sẽ cố gắng học tập và làm việc thật tốt để không phụ lòng Bố Mẹ. Con yêu Bố Mẹ nhiều lắm!`;
              break;
            case "children":
              content = `Gửi các con yêu quý,<br><br>Năm mới đến, ba/mẹ gửi đến các con lời chúc tốt đẹp nhất. Chúc các con luôn khỏe mạnh, vui vẻ và học hành chăm ngoan.<br><br>Ba/mẹ rất tự hào về các con, những đứa trẻ ngoan ngoãn và hiếu thảo. Mong rằng năm mới sẽ mang đến cho các con thật nhiều niềm vui, thành tích tốt trong học tập và nhiều kỷ niệm đẹp.<br><br>Hãy luôn giữ cho mình trái tim ấm áp và tinh thần lạc quan. Ba/mẹ yêu các con rất nhiều!`;
              break;
            default:
              content = `Xuân mới lại về, mang theo bao niềm vui và hy vọng. Nhân dịp năm mới, xin gửi đến ${relationship.name.toLowerCase()} lời chúc sức khỏe, an khang và thịnh vượng.<br><br>Chúc ${relationship.name.toLowerCase()} luôn dồi dào sức khỏe, tinh thần minh mẫn, và tràn đầy niềm vui trong cuộc sống. Mong rằng năm mới sẽ mang đến nhiều may mắn, thành công và hạnh phúc.<br><br>Dù không gian có cách trở nhưng tấm lòng và tình cảm luôn hướng về ${relationship.name.toLowerCase()}. Xin gửi qua những dòng chữ này tất cả sự trân trọng và yêu thương chân thành nhất.`;
          }

          const letter = {
            date: `Ngày ${dateStr}`,
            greeting: `${relationship.formal},`,
            content: content,
            closing: letterClosings[selectedRelationshipId],
          };

          return letter;
        }

        // Stop Dice Rolling
        function stopDiceRolling() {
          dice1.classList.remove("rolling");
          dice2.classList.remove("rolling");
          dice3.classList.remove("rolling");

          const diceValues = [
            Math.floor(Math.random() * 6) + 1,
            Math.floor(Math.random() * 6) + 1,
            Math.floor(Math.random() * 6) + 1,
          ];

          const rotations = [
            { x: diceValues[0] * 60, y: diceValues[0] * 60 },
            { x: diceValues[1] * 60, y: diceValues[1] * 60 },
            { x: diceValues[2] * 60, y: diceValues[2] * 60 },
          ];

          dice1.style.transform = `rotateX(${rotations[0].x}deg) rotateY(${rotations[0].y}deg)`;
          dice2.style.transform = `rotateX(${rotations[1].x}deg) rotateY(${rotations[1].y}deg)`;
          dice3.style.transform = `rotateX(${rotations[2].x}deg) rotateY(${rotations[2].y}deg)`;
        }

        // Show Letter and Scratch
        function showLetterAndScratch(letter, amount, message) {
          diceSection.classList.add("hidden");
          letterScratchSection.classList.remove("hidden");

          letterDate.textContent = letter.date;
          letterGreeting.textContent = letter.greeting;
          letterContent.innerHTML = letter.content;
          letterClosing.textContent = letter.closing;

          moneyAmount.textContent = formatCurrency(amount);
          moneyMessage.textContent = message;

          initScratchCard();
        }

        // Get Random Amount
        function getRandomAmount() {
          const min = 50000;
          const max = 5000000;

          const rand = Math.random();
          let amount;

          if (rand < 0.02) {
            amount = min + Math.floor(Math.random() * (max * 2 - min + 1));
          } else if (rand < 0.1) {
            amount = min + Math.floor(Math.random() * (max - min + 1));
          } else if (rand < 0.4) {
            amount = min + Math.floor(Math.random() * (max / 2 - min + 1));
          } else {
            amount = min + Math.floor(Math.random() * (max / 4 - min + 1));
          }

          return Math.round(amount / 1000) * 1000;
        }

        // Format Currency
        function formatCurrency(amount) {
          return amount.toLocaleString("vi-VN") + " ₫";
        }

        // Initialize Scratch Card
        function initScratchCard() {
          const canvas = scratchCanvas;
          const container = canvas.parentElement;

          canvas.width = 0;
          canvas.height = 0;

          const newCanvas = canvas.cloneNode(true);
          canvas.parentNode.replaceChild(newCanvas, canvas);
          scratchCanvas = newCanvas;

          canvas.width = container.offsetWidth;
          canvas.height = container.offsetHeight;

          ctx = canvas.getContext("2d");

          ctx.fillStyle = "#C0C0C0";
          ctx.fillRect(0, 0, canvas.width, canvas.height);

          ctx.fillStyle = "#D3D3D3";
          for (let x = 0; x < canvas.width; x += 20) {
            for (let y = 0; y < canvas.height; y += 20) {
              if ((x + y) % 40 === 0) {
                ctx.fillRect(x, y, 10, 10);
              }
            }
          }

          const gradient = ctx.createLinearGradient(
            0,
            0,
            canvas.width,
            canvas.height,
          );
          gradient.addColorStop(0, "rgba(255, 255, 255, 0.3)");
          gradient.addColorStop(0.5, "rgba(255, 255, 255, 0.1)");
          gradient.addColorStop(1, "rgba(255, 255, 255, 0.3)");
          ctx.fillStyle = gradient;
          ctx.fillRect(0, 0, canvas.width, canvas.height);

          ctx.fillStyle = "#8B4513";
          ctx.font = "bold 14px Arial";
          ctx.textAlign = "center";
          ctx.textBaseline = "middle";
          ctx.fillText("Vui lòng cào tại đây", canvas.width / 2, 30);

          canvas.addEventListener("mousedown", handleMouseDown);
          canvas.addEventListener("mousemove", handleMouseMove);
          canvas.addEventListener("mouseup", handleMouseUp);
          canvas.addEventListener("mouseleave", handleMouseUp);

          canvas.addEventListener("touchstart", handleTouchStart);
          canvas.addEventListener("touchmove", handleTouchMove);
          canvas.addEventListener("touchend", handleTouchEnd);

          canvas.addEventListener("touchstart", (e) => e.preventDefault(), {
            passive: false,
          });
          canvas.addEventListener("touchmove", (e) => e.preventDefault(), {
            passive: false,
          });
        }

        // Event handler functions
        function handleMouseDown(e) {
          isScratching = true;
          scratch(e.clientX, e.clientY);
        }

        function handleMouseMove(e) {
          if (!isScratching) return;
          scratch(e.clientX, e.clientY);
        }

        function handleMouseUp() {
          isScratching = false;
        }

        function handleTouchStart(e) {
          isScratching = true;
          const touch = e.touches[0];
          scratch(touch.clientX, touch.clientY);
        }

        function handleTouchMove(e) {
          if (!isScratching || !e.touches.length) return;
          const touch = e.touches[0];
          scratch(touch.clientX, touch.clientY);
        }

        function handleTouchEnd() {
          isScratching = false;
        }

        // Scratch Function
        function scratch(clientX, clientY) {
          if (!ctx) return;

          const rect = scratchCanvas.getBoundingClientRect();
          const x = clientX - rect.left;
          const y = clientY - rect.top;

          if (x < 0 || x > rect.width || y < 0 || y > rect.height) return;

          ctx.globalCompositeOperation = "destination-out";

          const radius = 25;
          const gradient = ctx.createRadialGradient(x, y, 0, x, y, radius);
          gradient.addColorStop(0, "rgba(0,0,0,1)");
          gradient.addColorStop(0.7, "rgba(0,0,0,0.8)");
          gradient.addColorStop(1, "rgba(0,0,0,0)");

          ctx.beginPath();
          ctx.arc(x, y, radius, 0, Math.PI * 2);
          ctx.fillStyle = gradient;
          ctx.fill();

          checkScratchCompletion();
        }

        // Check Scratch Completion
        function checkScratchCompletion() {
          if (!ctx) return;

          const imageData = ctx.getImageData(
            0,
            0,
            scratchCanvas.width,
            scratchCanvas.height,
          );
          const pixels = imageData.data;
          let transparentCount = 0;

          for (let i = 3; i < pixels.length; i += 4) {
            if (pixels[i] < 128) {
              transparentCount++;
            }
          }

          const totalPixels = pixels.length / 4;
          const scratchedPercent = (transparentCount / totalPixels) * 100;

          if (
            scratchedPercent > 25 &&
            !playAgainBtn.classList.contains("fade-in")
          ) {
            playAgainBtn.classList.remove("hidden");
            playAgainBtn.classList.add("fade-in");
          }
        }

        // Close Modal
        function closeModal() {
          resultModal.classList.add("hidden");
          modalOverlay.classList.add("hidden");
          document.body.style.overflow = "auto";

          dice1.style.transform = "";
          dice2.style.transform = "";
          dice3.style.transform = "";

          if (selectedHongbao) {
            selectedHongbao.classList.remove("selected");
            selectedHongbao = null;
          }

          hongbaoSelection.classList.add("hidden");
          ageSelection.classList.add("hidden");
          relationshipSelection.classList.remove("hidden");

          if (selectedRelationship) {
            selectedRelationship.classList.remove("selected");
            selectedRelationship = null;
          }
          if (selectedAge) {
            selectedAge.classList.remove("selected");
            selectedAge = null;
          }

          updateStepIndicator(1);

          relationshipGrid.innerHTML = "";
          initRelationshipSelection();
        }

        // Play Again
        function playAgain() {
          closeModal();
        }

        // Event Listeners
        closeModalBtn.addEventListener("click", closeModal);
        modalOverlay.addEventListener("click", closeModal);
        playAgainBtn.addEventListener("click", playAgain);

        document.addEventListener("keydown", function (e) {
          if (e.key === "Escape" && !resultModal.classList.contains("hidden")) {
            closeModal();
          }
        });

        // Initialize
        initRelationshipSelection();
      });
    </script>
  </body>
</html>
